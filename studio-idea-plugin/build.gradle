buildscript {
    repositories {
        maven {
            url 'http://dl.bintray.com/jetbrains/intellij-plugin-service'
        }
    }
}

plugins {
    id "org.jetbrains.intellij" version "0.4.21"
    id "com.palantir.git-version" version "0.12.2"
}

apply from: "$rootDir/$project.name/verifier.gradle"

dependencies {
    compile("com.evolveum.midpoint.model:model-common:$midpointVersion") {
        transitive = false
    }
    compile("com.evolveum.midpoint.model:model-api:$midpointVersion") {
        transitive = false
    }
    compile("com.evolveum.midpoint.repo:security-api:$midpointVersion") {
        transitive = false
    }
    compile("com.evolveum.midpoint.model:notifications-api:$midpointVersion") {
        transitive = false
    }
    compile "com.evolveum.midpoint:midpoint-localization:$midpointVersion"
    compile("com.evolveum.midpoint:midscribe-core:$midscribeVersion") {
        exclude group: "org.springframework"
        exclude group: "net.sf.jasperreports"
        exclude group: "org.apache.cxf", module: "cxf-rt-wsdl"

        exclude group: "org.slf4j"
        exclude group: "ch.qos.logback"
    }

    compile "de.slackspace:openkeepass:$openkeepass"
    compile "org.apache.commons:commons-lang3:$commonsLang"
//    compile "org.knowm.xchart:xchart:$xchartVersion"
    compile "org.slf4j:slf4j-log4j12:$slf4jVersion"
    compile "com.squareup.okhttp3:okhttp:$okHttpVersion"
    compile "com.squareup.okhttp3:logging-interceptor:$okHttpVersion"

    // dependencies form midpoint-client, todo cleanup

    compile("com.evolveum.midpoint.model:model-impl:$midpointVersion") {
        transitive = false
    }
    compile("com.evolveum.midpoint.infra:common:$midpointVersion") {
        exclude group: "org.springframework"
        exclude group: "net.sf.jasperreports"
        exclude group: "org.apache.cxf", module: "cxf-rt-wsdl"
        exclude group: "org.slf4j"
        exclude group: "ch.qos.logback"
    }
    compile("org.springframework:spring-core:$springVersion") {
        transitive = false
    }

    // from model client
    compile "org.apache.cxf:cxf-core:$cxfVersion"
    compile "org.apache.cxf:cxf-rt-frontend-jaxrs:$cxfVersion"
    compile "org.apache.cxf:cxf-rt-rs-extension-providers:$cxfVersion"
    compile "org.apache.cxf:cxf-rt-rs-client:$cxfVersion"
    compile "org.apache.cxf:cxf-rt-features-logging:$cxfVersion"
    compile("org.apache.cxf:cxf-rt-wsdl:$cxfVersion") {
        transitive = false
    }
    compile "stax:stax:$staxVersion"
}

intellij {
    version '2020.2'    // 'LATEST-EAP-SNAPSHOT'
    type 'IC'
    downloadSources true
    pluginName 'MidPoint Studio'
    updateSinceUntilBuild false
    plugins = [
            'PsiViewer:202-SNAPSHOT.3',
            'com.jetbrains.hackathon.indices.viewer:1.8',
            'java',
            'Groovy',
            'maven'
    ]
    patchPluginXml {
        sinceBuild '193'
        untilBuild '202.*'
        version project.version + '.' + versionDetails().commitDistance
    }
    publishPlugin {
        channels project.channels
        token System.getenv('studio_intellijPublishToken')
    }
}

runPluginVerifier {
    pluginFileName = "$intellij.pluginName-$version"
    ides = ["IC-2019.3", "IC-2020.1", "IC-2020.2", "IC-LATEST-EAP-SNAPSHOT"]
}

buildPlugin.configure {
    doFirst {
        println "Git describe: " + versionDetails().commitDistance
    }
}
